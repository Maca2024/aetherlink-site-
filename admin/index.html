<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AetherLink Blog CMS — Admin Dashboard</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" type="image/png" href="../images/favicon.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        display: ['Syne', 'sans-serif'],
                        body: ['Plus Jakarta Sans', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        void: '#05060f',
                        surface: { DEFAULT: '#0a0d1a', 2: '#111527', 3: '#181d35' },
                        accent: { cyan: '#00d4ff', violet: '#8b5cf6', emerald: '#00dfa2' },
                        muted: '#6b7394',
                        light: '#e4e8f1',
                    }
                }
            }
        }
    </script>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        *, *::before, *::after { box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #05060f;
            color: #e4e8f1;
            overflow-x: hidden;
            margin: 0;
            min-height: 100vh;
        }

        .font-display { font-family: 'Syne', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Noise grain overlay */
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 9999;
            opacity: 0.3;
        }

        /* Grid background */
        .grid-bg {
            background-image:
                linear-gradient(rgba(255,255,255,0.015) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.015) 1px, transparent 1px);
            background-size: 72px 72px;
        }

        /* Glass morphism */
        .glass {
            background: rgba(255,255,255,0.025);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255,255,255,0.06);
        }
        .glass-hover:hover {
            background: rgba(255,255,255,0.04);
            border-color: rgba(255,255,255,0.12);
        }

        /* Gradient orbs */
        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(120px);
            pointer-events: none;
            z-index: 0;
        }
        .orb-1 {
            width: 500px; height: 500px;
            background: radial-gradient(circle, rgba(0,212,255,0.12), transparent 70%);
            top: -15%; left: -10%;
            animation: float1 30s ease-in-out infinite;
        }
        .orb-2 {
            width: 400px; height: 400px;
            background: radial-gradient(circle, rgba(139,92,246,0.10), transparent 70%);
            bottom: -10%; right: -5%;
            animation: float2 25s ease-in-out infinite;
        }
        @keyframes float1 {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(60px, 40px); }
        }
        @keyframes float2 {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-40px, -30px); }
        }

        /* Buttons */
        .btn-primary {
            display: inline-flex; align-items: center; gap: 8px;
            background: linear-gradient(135deg, #00d4ff, #8b5cf6);
            color: #fff; padding: 10px 24px; border-radius: 12px;
            font-family: 'Syne', sans-serif; font-weight: 600; font-size: 0.875rem;
            border: none; cursor: pointer;
            transition: all 0.35s cubic-bezier(0.16,1,0.3,1);
            box-shadow: 0 0 20px rgba(0,212,255,0.15), 0 4px 16px -4px rgba(139,92,246,0.2);
            text-decoration: none;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 32px rgba(0,212,255,0.25), 0 8px 24px -4px rgba(139,92,246,0.3);
        }
        .btn-primary:disabled {
            opacity: 0.5; cursor: not-allowed; transform: none;
            box-shadow: none;
        }

        .btn-violet {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            box-shadow: 0 0 20px rgba(139,92,246,0.15), 0 4px 16px -4px rgba(139,92,246,0.2);
        }
        .btn-violet:hover {
            box-shadow: 0 0 32px rgba(139,92,246,0.25), 0 8px 24px -4px rgba(168,85,247,0.3);
        }

        .btn-secondary {
            display: inline-flex; align-items: center; gap: 8px;
            background: transparent; color: #e4e8f1;
            padding: 10px 24px; border-radius: 12px;
            font-family: 'Syne', sans-serif; font-weight: 500; font-size: 0.875rem;
            border: 1px solid rgba(255,255,255,0.1); cursor: pointer;
            transition: all 0.35s cubic-bezier(0.16,1,0.3,1);
            text-decoration: none;
        }
        .btn-secondary:hover {
            border-color: rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.04);
            transform: translateY(-1px);
        }
        .btn-secondary:disabled {
            opacity: 0.5; cursor: not-allowed; transform: none;
        }

        .btn-danger {
            background: rgba(239,68,68,0.1);
            color: #ef4444;
            border: 1px solid rgba(239,68,68,0.2);
        }
        .btn-danger:hover {
            background: rgba(239,68,68,0.2);
            border-color: rgba(239,68,68,0.4);
        }

        .btn-sm {
            padding: 6px 14px; font-size: 0.8rem; border-radius: 8px;
        }

        /* Form elements */
        .input {
            width: 100%;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 12px 16px;
            color: #e4e8f1;
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            outline: none;
        }
        .input:focus {
            border-color: rgba(0,212,255,0.4);
            background: rgba(255,255,255,0.06);
            box-shadow: 0 0 0 3px rgba(0,212,255,0.08);
        }
        .input::placeholder {
            color: #4a5168;
        }

        .input-lg {
            padding: 14px 18px;
            font-size: 1rem;
        }

        .textarea-content {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.82rem;
            line-height: 1.7;
            min-height: 400px;
            resize: vertical;
        }

        select.input {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%236b7394' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }

        /* Status badges */
        .badge {
            display: inline-flex; align-items: center;
            padding: 3px 10px; border-radius: 6px;
            font-size: 0.72rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.05em;
            font-family: 'Syne', sans-serif;
        }
        .badge-draft { background: rgba(107,115,148,0.15); color: #6b7394; }
        .badge-review { background: rgba(234,179,8,0.12); color: #eab308; }
        .badge-published { background: rgba(0,223,162,0.12); color: #00dfa2; }
        .badge-archived { background: rgba(239,68,68,0.12); color: #ef4444; }

        /* Category badges */
        .cat-badge {
            display: inline-flex; align-items: center;
            padding: 3px 10px; border-radius: 6px;
            font-size: 0.72rem; font-weight: 500;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
        .cat-aetherbot { background: rgba(0,212,255,0.1); color: #00d4ff; }
        .cat-aethermind { background: rgba(139,92,246,0.1); color: #8b5cf6; }
        .cat-aetherdev { background: rgba(0,223,162,0.1); color: #00dfa2; }

        /* Toast notifications */
        .toast-container {
            position: fixed; top: 80px; right: 20px; z-index: 10000;
            display: flex; flex-direction: column; gap: 10px;
        }
        .toast {
            padding: 14px 20px; border-radius: 12px;
            font-size: 0.85rem; font-weight: 500;
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            animation: slideIn 0.4s cubic-bezier(0.16,1,0.3,1);
            display: flex; align-items: center; gap: 10px;
            max-width: 400px;
            border: 1px solid rgba(255,255,255,0.06);
        }
        .toast-success {
            background: rgba(0,223,162,0.12);
            border-color: rgba(0,223,162,0.2);
            color: #00dfa2;
        }
        .toast-error {
            background: rgba(239,68,68,0.12);
            border-color: rgba(239,68,68,0.2);
            color: #ef4444;
        }
        .toast-info {
            background: rgba(0,212,255,0.12);
            border-color: rgba(0,212,255,0.2);
            color: #00d4ff;
        }
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100px); opacity: 0; }
        }

        /* Spinner */
        .spinner {
            width: 20px; height: 20px;
            border: 2px solid rgba(255,255,255,0.1);
            border-top-color: #00d4ff;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }
        .spinner-lg {
            width: 40px; height: 40px;
            border-width: 3px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tab system */
        .tab-btn {
            padding: 8px 20px; border-radius: 8px;
            font-family: 'Syne', sans-serif; font-weight: 500;
            font-size: 0.85rem; color: #6b7394;
            background: transparent; border: 1px solid transparent;
            cursor: pointer; transition: all 0.3s ease;
        }
        .tab-btn:hover { color: #e4e8f1; }
        .tab-btn.active {
            color: #00d4ff;
            background: rgba(0,212,255,0.08);
            border-color: rgba(0,212,255,0.2);
        }

        /* Filter buttons */
        .filter-btn {
            padding: 6px 16px; border-radius: 8px;
            font-family: 'Syne', sans-serif; font-weight: 500;
            font-size: 0.8rem; color: #6b7394;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.06);
            cursor: pointer; transition: all 0.3s ease;
        }
        .filter-btn:hover { color: #e4e8f1; border-color: rgba(255,255,255,0.12); }
        .filter-btn.active {
            color: #fff;
            background: linear-gradient(135deg, rgba(139,92,246,0.15), rgba(0,212,255,0.1));
            border-color: rgba(139,92,246,0.3);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #05060f; }
        ::-webkit-scrollbar-thumb { background: #1e2444; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #2a3158; }

        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #00d4ff, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Screen transitions */
        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .screen.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Modal overlay */
        .modal-overlay {
            position: fixed; inset: 0; z-index: 1000;
            background: rgba(5,6,15,0.85);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            display: none; align-items: center; justify-content: center;
            padding: 20px;
        }
        .modal-overlay.open {
            display: flex;
        }
        .modal-content {
            width: 100%; max-width: 900px; max-height: 90vh;
            overflow-y: auto;
            background: #0a0d1a;
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 20px;
            animation: modalIn 0.35s cubic-bezier(0.16,1,0.3,1);
        }
        @keyframes modalIn {
            from { transform: scale(0.95) translateY(20px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }

        /* Stat card */
        .stat-card {
            background: rgba(255,255,255,0.025);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 16px;
            padding: 20px 24px;
            transition: all 0.4s cubic-bezier(0.16,1,0.3,1);
        }
        .stat-card:hover {
            background: rgba(255,255,255,0.04);
            border-color: rgba(255,255,255,0.1);
            transform: translateY(-4px);
            box-shadow: 0 16px 40px -12px rgba(0,0,0,0.3);
        }

        /* Posts table row */
        .post-row {
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255,255,255,0.04);
        }
        .post-row:hover {
            background: rgba(255,255,255,0.02);
        }
        .post-row:last-child {
            border-bottom: none;
        }

        /* Research card */
        .research-result {
            background: rgba(0,212,255,0.04);
            border: 1px solid rgba(0,212,255,0.1);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            white-space: pre-wrap;
            font-size: 0.85rem;
            line-height: 1.7;
            max-height: 400px;
            overflow-y: auto;
        }

        /* Progress bar */
        .progress-bar {
            height: 4px;
            background: rgba(255,255,255,0.06);
            border-radius: 2px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #8b5cf6);
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        /* Keyword tag */
        .keyword-tag {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 4px 10px; border-radius: 6px;
            background: rgba(139,92,246,0.1);
            border: 1px solid rgba(139,92,246,0.2);
            font-size: 0.78rem; color: #a78bfa;
        }
        .keyword-tag button {
            background: none; border: none; color: #a78bfa;
            cursor: pointer; font-size: 1rem; line-height: 1;
            padding: 0; opacity: 0.6;
            transition: opacity 0.2s;
        }
        .keyword-tag button:hover { opacity: 1; }

        /* Preview iframe */
        .preview-frame {
            width: 100%;
            min-height: 600px;
            border: none;
            border-radius: 12px;
            background: #fff;
        }

        /* Cross-post checkbox */
        .checkbox-wrap {
            display: flex; align-items: center; gap: 10px;
            cursor: pointer; user-select: none;
        }
        .checkbox-wrap input[type="checkbox"] {
            width: 18px; height: 18px;
            accent-color: #8b5cf6;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .orb { width: 250px !important; height: 250px !important; }
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7394;
        }
        .empty-state svg {
            width: 64px; height: 64px;
            margin: 0 auto 16px;
            opacity: 0.3;
        }
    </style>
</head>

<body class="grid-bg">

    <!-- Background orbs -->
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <!-- Toast container -->
    <div id="toasts" class="toast-container"></div>

    <!-- ═══════════════════════════════════════════════ -->
    <!-- LOGIN SCREEN                                    -->
    <!-- ═══════════════════════════════════════════════ -->
    <div id="screen-login" class="screen active">
        <div class="min-h-screen flex items-center justify-center p-6">
            <div class="glass rounded-2xl p-8 md:p-10 w-full max-w-md relative">
                <!-- Accent line -->
                <div class="absolute top-0 left-[15%] right-[15%] h-[2px] rounded-b bg-gradient-to-r from-transparent via-accent-cyan to-transparent opacity-60"></div>

                <!-- Logo -->
                <div class="text-center mb-8">
                    <img src="../images/logo-white.png" alt="AetherLink" class="h-10 mx-auto mb-4">
                    <h1 class="font-display text-xl font-bold text-light">Admin Dashboard</h1>
                    <p class="text-muted text-sm mt-1">Blog Content Management System</p>
                </div>

                <!-- Login Form -->
                <form id="login-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-muted mb-2">Email</label>
                        <input type="email" id="login-email" class="input" placeholder="admin@aetherlink.ai" required autocomplete="email">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-muted mb-2">Password</label>
                        <input type="password" id="login-password" class="input" placeholder="Enter password" required autocomplete="current-password">
                    </div>
                    <div id="login-error" class="hidden text-red-400 text-sm text-center py-2"></div>
                    <button type="submit" id="login-btn" class="btn-primary w-full justify-center text-center">
                        <span>Sign In</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                    </button>
                </form>

                <!-- Divider -->
                <div class="flex items-center gap-4 my-6">
                    <div class="flex-1 h-px bg-white/10"></div>
                    <span class="text-muted/50 text-xs uppercase tracking-wider">or</span>
                    <div class="flex-1 h-px bg-white/10"></div>
                </div>

                <!-- Google Sign In -->
                <button id="google-login-btn" onclick="handleGoogleLogin()" class="w-full flex items-center justify-center gap-3 px-4 py-3 rounded-xl border border-white/10 bg-white/[0.03] hover:bg-white/[0.07] hover:border-white/20 transition-all duration-300 group">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    <span class="text-sm font-medium text-muted group-hover:text-light transition-colors">Sign in with Google</span>
                </button>

                <div class="mt-6 text-center">
                    <p class="text-muted/50 text-xs">Secured by Supabase Auth</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════ -->
    <!-- DASHBOARD SCREEN                                -->
    <!-- ═══════════════════════════════════════════════ -->
    <div id="screen-dashboard" class="screen">

        <!-- Top Bar -->
        <header class="sticky top-0 z-50 glass border-b border-white/5">
            <div class="max-w-[1400px] mx-auto px-4 md:px-8 h-16 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <img src="../images/logo-white.png" alt="AetherLink" class="h-7">
                    <span class="font-display font-semibold text-sm text-muted hidden sm:inline">Blog CMS</span>
                </div>
                <div class="flex items-center gap-4">
                    <span id="user-email" class="text-xs text-muted hidden md:inline truncate max-w-[200px]"></span>
                    <button onclick="handleLogout()" class="btn-secondary btn-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </header>

        <main class="max-w-[1400px] mx-auto px-4 md:px-8 py-8">

            <!-- Stats Row -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="stat-card">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-9 h-9 rounded-lg bg-accent-cyan/10 flex items-center justify-center">
                            <svg class="w-5 h-5 text-accent-cyan" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
                        </div>
                        <span class="text-xs text-muted font-medium">Total Posts</span>
                    </div>
                    <div id="stat-total" class="text-2xl font-display font-bold text-light">--</div>
                </div>
                <div class="stat-card">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-9 h-9 rounded-lg bg-accent-emerald/10 flex items-center justify-center">
                            <svg class="w-5 h-5 text-accent-emerald" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </div>
                        <span class="text-xs text-muted font-medium">Published</span>
                    </div>
                    <div id="stat-published" class="text-2xl font-display font-bold text-accent-emerald">--</div>
                </div>
                <div class="stat-card">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-9 h-9 rounded-lg bg-white/5 flex items-center justify-center">
                            <svg class="w-5 h-5 text-muted" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                        </div>
                        <span class="text-xs text-muted font-medium">Drafts</span>
                    </div>
                    <div id="stat-drafts" class="text-2xl font-display font-bold text-light">--</div>
                </div>
                <div class="stat-card">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-9 h-9 rounded-lg bg-accent-violet/10 flex items-center justify-center">
                            <svg class="w-5 h-5 text-accent-violet" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        </div>
                        <span class="text-xs text-muted font-medium">AI Generated</span>
                    </div>
                    <div id="stat-ai" class="text-2xl font-display font-bold text-accent-violet">--</div>
                </div>
            </div>

            <!-- Actions Bar -->
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
                <div class="flex flex-wrap gap-2">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="published">Published</button>
                    <button class="filter-btn" data-filter="draft">Drafts</button>
                    <button class="filter-btn" data-filter="review">Review</button>
                    <button class="filter-btn" data-filter="archived">Archived</button>
                </div>
                <div class="flex gap-3">
                    <button onclick="navigateTo('generate')" class="btn-primary btn-violet btn-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        <span>AI Generate</span>
                    </button>
                    <button onclick="createNewPost()" class="btn-primary btn-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                        <span>New Post</span>
                    </button>
                </div>
            </div>

            <!-- Posts Table -->
            <div class="glass rounded-2xl overflow-hidden">
                <!-- Table Header -->
                <div class="hidden md:grid grid-cols-12 gap-4 px-6 py-3 text-xs text-muted font-display font-medium uppercase tracking-wider border-b border-white/5">
                    <div class="col-span-5">Title</div>
                    <div class="col-span-2">Status</div>
                    <div class="col-span-2">Category</div>
                    <div class="col-span-2">Date</div>
                    <div class="col-span-1 text-right">Actions</div>
                </div>

                <!-- Table Body -->
                <div id="posts-list">
                    <!-- Loading state -->
                    <div id="posts-loading" class="flex items-center justify-center py-16">
                        <div class="spinner spinner-lg"></div>
                    </div>
                </div>

                <!-- Empty state (hidden by default) -->
                <div id="posts-empty" class="hidden empty-state">
                    <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg>
                    <h3 class="font-display font-semibold text-light text-lg mb-1">No posts yet</h3>
                    <p class="text-sm mb-4">Create your first blog post or generate one with AI</p>
                    <button onclick="createNewPost()" class="btn-primary btn-sm mx-auto">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                        <span>Create Post</span>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- ═══════════════════════════════════════════════ -->
    <!-- EDITOR SCREEN                                   -->
    <!-- ═══════════════════════════════════════════════ -->
    <div id="screen-editor" class="screen">

        <!-- Top Bar -->
        <header class="sticky top-0 z-50 glass border-b border-white/5">
            <div class="max-w-[1400px] mx-auto px-4 md:px-8 h-16 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <button onclick="navigateTo('dashboard')" class="text-muted hover:text-light transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
                    </button>
                    <img src="../images/logo-white.png" alt="AetherLink" class="h-6">
                    <span class="font-display font-semibold text-sm text-muted">Post Editor</span>
                </div>
                <div class="flex items-center gap-3">
                    <span id="editor-autosave" class="text-xs text-muted hidden">Saved</span>
                    <button onclick="handleSaveDraft()" class="btn-secondary btn-sm" id="btn-save-draft">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/></svg>
                        <span>Save Draft</span>
                    </button>
                    <button onclick="openPreview()" class="btn-secondary btn-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                        <span class="hidden sm:inline">Preview</span>
                    </button>
                    <button onclick="handlePublish()" class="btn-primary btn-sm" id="btn-publish">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
                        <span>Publish</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-[1400px] mx-auto px-4 md:px-8 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">

                <!-- Main editor area -->
                <div class="lg:col-span-3 space-y-6">

                    <!-- Title & Slug & Meta row -->
                    <div class="glass rounded-2xl p-6 space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Category</label>
                                <select id="editor-category" class="input" onchange="updateEditorState()">
                                    <option value="aetherbot">AetherBot</option>
                                    <option value="aethermind">AetherMIND</option>
                                    <option value="aetherdev">AetherDEV</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Status</label>
                                <select id="editor-status" class="input" onchange="updateEditorState()">
                                    <option value="draft">Draft</option>
                                    <option value="review">In Review</option>
                                    <option value="published">Published</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Language Tabs -->
                    <div class="glass rounded-2xl overflow-hidden">
                        <!-- Tab header -->
                        <div class="flex items-center gap-1 px-4 pt-4 pb-0">
                            <button class="tab-btn active" data-lang="nl" onclick="switchEditorLang('nl')">
                                <span class="mr-1">&#x1F1F3;&#x1F1F1;</span> NL
                            </button>
                            <button class="tab-btn" data-lang="en" onclick="switchEditorLang('en')">
                                <span class="mr-1">&#x1F1EC;&#x1F1E7;</span> EN
                            </button>
                            <button class="tab-btn" data-lang="fi" onclick="switchEditorLang('fi')">
                                <span class="mr-1">&#x1F1EB;&#x1F1EE;</span> FI
                            </button>
                        </div>

                        <!-- NL Tab -->
                        <div id="tab-nl" class="p-6 space-y-4">
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Title (NL)</label>
                                <input type="text" id="editor-title-nl" class="input input-lg font-display font-bold" placeholder="Article title in Dutch" oninput="autoSlug('nl')">
                            </div>
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Slug (NL)</label>
                                <input type="text" id="editor-slug-nl" class="input font-mono text-sm" placeholder="article-slug-nl">
                            </div>
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Description / SEO (NL)</label>
                                <textarea id="editor-desc-nl" class="input" rows="3" placeholder="Brief description for SEO and social sharing..."></textarea>
                            </div>
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Content HTML (NL)</label>
                                <textarea id="editor-content-nl" class="input textarea-content" placeholder="<h2>Introduction</h2>&#10;<p>Your article content...</p>"></textarea>
                            </div>
                        </div>

                        <!-- EN Tab -->
                        <div id="tab-en" class="p-6 space-y-4 hidden">
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Title (EN)</label>
                                <input type="text" id="editor-title-en" class="input input-lg font-display font-bold" placeholder="Article title in English" oninput="autoSlug('en')">
                            </div>
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Slug (EN)</label>
                                <input type="text" id="editor-slug-en" class="input font-mono text-sm" placeholder="article-slug-en">
                            </div>
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Description / SEO (EN)</label>
                                <textarea id="editor-desc-en" class="input" rows="3" placeholder="Brief description for SEO and social sharing..."></textarea>
                            </div>
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Content HTML (EN)</label>
                                <textarea id="editor-content-en" class="input textarea-content" placeholder="<h2>Introduction</h2>&#10;<p>Your article content...</p>"></textarea>
                            </div>
                        </div>

                        <!-- FI Tab -->
                        <div id="tab-fi" class="p-6 space-y-4 hidden">
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Title (FI)</label>
                                <input type="text" id="editor-title-fi" class="input input-lg font-display font-bold" placeholder="Article title in Finnish" oninput="autoSlug('fi')">
                            </div>
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Slug (FI)</label>
                                <input type="text" id="editor-slug-fi" class="input font-mono text-sm" placeholder="article-slug-fi">
                            </div>
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Description / SEO (FI)</label>
                                <textarea id="editor-desc-fi" class="input" rows="3" placeholder="Brief description for SEO and social sharing..."></textarea>
                            </div>
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Content HTML (FI)</label>
                                <textarea id="editor-content-fi" class="input textarea-content" placeholder="<h2>Introduction</h2>&#10;<p>Your article content...</p>"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Cross-Post Section -->
                    <div class="glass rounded-2xl p-6">
                        <h3 class="font-display font-semibold text-sm text-light mb-4">Cross-Post Distribution</h3>
                        <div class="flex flex-col sm:flex-row gap-6">
                            <label class="checkbox-wrap">
                                <input type="checkbox" id="crosspost-linkedin">
                                <div class="flex items-center gap-2">
                                    <svg class="w-5 h-5 text-[#0A66C2]" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                    <span class="text-sm text-light">Post to LinkedIn</span>
                                </div>
                            </label>
                            <label class="checkbox-wrap">
                                <input type="checkbox" id="crosspost-medium">
                                <div class="flex items-center gap-2">
                                    <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zm7.42 0c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z"/></svg>
                                    <span class="text-sm text-light">Post to Medium</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">

                    <!-- Author & Meta -->
                    <div class="glass rounded-2xl p-5 space-y-4">
                        <h3 class="font-display font-semibold text-sm text-light">Post Metadata</h3>
                        <div>
                            <label class="block text-xs text-muted font-medium mb-2">Author</label>
                            <input type="text" id="editor-author" class="input" value="Marco" placeholder="Author name">
                        </div>
                        <div>
                            <label class="block text-xs text-muted font-medium mb-2">Author Title</label>
                            <input type="text" id="editor-author-title" class="input" value="CTO & AI Lead Architect" placeholder="Author title">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Read Time</label>
                                <div id="editor-readtime" class="input bg-white/[0.02] text-muted text-sm cursor-default">0 min</div>
                            </div>
                            <div>
                                <label class="block text-xs text-muted font-medium mb-2">Words</label>
                                <div id="editor-wordcount" class="input bg-white/[0.02] text-muted text-sm cursor-default">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- SEO Keywords -->
                    <div class="glass rounded-2xl p-5 space-y-4">
                        <h3 class="font-display font-semibold text-sm text-light">SEO Keywords</h3>
                        <div class="flex gap-2">
                            <input type="text" id="keyword-input" class="input flex-1" placeholder="Add keyword" onkeydown="if(event.key==='Enter'){event.preventDefault();addKeyword()}">
                            <button onclick="addKeyword()" class="btn-secondary btn-sm px-3">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                            </button>
                        </div>
                        <div id="keywords-list" class="flex flex-wrap gap-2"></div>
                    </div>

                    <!-- Quality & Feedback -->
                    <div class="glass rounded-2xl p-5 space-y-4">
                        <h3 class="font-display font-semibold text-sm text-light">Quality & Feedback</h3>
                        <div>
                            <label class="block text-xs text-muted font-medium mb-2">Quality Score (auto)</label>
                            <div id="editor-quality-score" class="input bg-white/[0.02] text-muted text-sm cursor-default">—</div>
                        </div>
                        <div>
                            <label class="block text-xs text-muted font-medium mb-2">Feedback Score (0-100)</label>
                            <input type="range" id="editor-feedback-score" min="0" max="100" value="0" class="w-full accent-accent-violet" oninput="document.getElementById('feedback-score-val').textContent=this.value">
                            <div class="flex justify-between text-xs text-muted mt-1">
                                <span>0</span>
                                <span id="feedback-score-val" class="text-light font-semibold">0</span>
                                <span>100</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs text-muted font-medium mb-2">Learning Notes</label>
                            <textarea id="editor-learning-notes" class="input text-sm" rows="3" placeholder="What should future articles learn from this one? E.g. 'More examples', 'Too long', 'Good humor'"></textarea>
                        </div>
                        <div>
                            <label class="block text-xs text-muted font-medium mb-2">Add Comment</label>
                            <div class="flex gap-2">
                                <input type="text" id="feedback-comment-input" class="input flex-1 text-sm" placeholder="Feedback comment..." onkeydown="if(event.key==='Enter'){event.preventDefault();addFeedbackComment()}">
                                <button onclick="addFeedbackComment()" class="btn-secondary btn-sm px-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                                </button>
                            </div>
                            <div id="feedback-comments-list" class="mt-2 space-y-1 text-xs text-muted max-h-32 overflow-y-auto"></div>
                        </div>
                    </div>

                    <!-- Danger Zone -->
                    <div class="glass rounded-2xl p-5 space-y-4 border-red-500/10">
                        <h3 class="font-display font-semibold text-sm text-red-400">Danger Zone</h3>
                        <button onclick="handleDeletePost()" class="btn-secondary btn-danger btn-sm w-full justify-center" id="btn-delete">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                            <span>Delete Post</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════ -->
    <!-- AI GENERATE SCREEN                              -->
    <!-- ═══════════════════════════════════════════════ -->
    <div id="screen-generate" class="screen">

        <!-- Top Bar -->
        <header class="sticky top-0 z-50 glass border-b border-white/5">
            <div class="max-w-[1400px] mx-auto px-4 md:px-8 h-16 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <button onclick="navigateTo('dashboard')" class="text-muted hover:text-light transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
                    </button>
                    <img src="../images/logo-white.png" alt="AetherLink" class="h-6">
                    <span class="font-display font-semibold text-sm gradient-text">AI Article Generator</span>
                </div>
            </div>
        </header>

        <div class="max-w-3xl mx-auto px-4 md:px-8 py-12">
            <div class="text-center mb-10">
                <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-accent-violet/20 to-accent-cyan/10 border border-accent-violet/20 flex items-center justify-center">
                    <svg class="w-8 h-8 text-accent-violet" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 00-2.455 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"/></svg>
                </div>
                <h1 class="font-display text-2xl font-bold text-light mb-2">AI Article Generator</h1>
                <p class="text-muted text-sm max-w-lg mx-auto">Research any topic with Perplexity AI and generate a professional multilingual article with Claude.</p>
            </div>

            <!-- Step 1: Topic -->
            <div class="glass rounded-2xl p-6 mb-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-7 h-7 rounded-full bg-accent-cyan/15 flex items-center justify-center text-accent-cyan font-display font-bold text-xs">1</div>
                    <h2 class="font-display font-semibold text-light text-sm">Define Topic</h2>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs text-muted font-medium mb-2">Topic / Title Idea</label>
                        <input type="text" id="gen-topic" class="input input-lg" placeholder="e.g., How MCP Servers Transform Enterprise AI Integration">
                    </div>
                    <div>
                        <label class="block text-xs text-muted font-medium mb-2">Category</label>
                        <select id="gen-category" class="input">
                            <option value="aetherbot">AetherBot</option>
                            <option value="aethermind">AetherMIND</option>
                            <option value="aetherdev">AetherDEV</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Step 2: Research -->
            <div class="glass rounded-2xl p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-7 h-7 rounded-full bg-accent-violet/15 flex items-center justify-center text-accent-violet font-display font-bold text-xs">2</div>
                        <h2 class="font-display font-semibold text-light text-sm">AI Research</h2>
                    </div>
                    <button onclick="handleResearch()" id="btn-research" class="btn-primary btn-violet btn-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                        <span>Research Topic</span>
                    </button>
                </div>
                <p class="text-muted text-xs mb-2">Perplexity AI will research the latest information about your topic.</p>
                <div id="research-output" class="hidden">
                    <div id="research-loading" class="hidden flex items-center gap-3 py-8 justify-center">
                        <div class="spinner"></div>
                        <span class="text-sm text-muted">Researching topic...</span>
                    </div>
                    <div id="research-result" class="research-result hidden"></div>
                </div>
            </div>

            <!-- Step 3: Generate -->
            <div class="glass rounded-2xl p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-7 h-7 rounded-full bg-accent-emerald/15 flex items-center justify-center text-accent-emerald font-display font-bold text-xs">3</div>
                        <h2 class="font-display font-semibold text-light text-sm">Generate Article</h2>
                    </div>
                    <button onclick="handleGenerate()" id="btn-generate" class="btn-primary btn-sm" disabled>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        <span>Generate Article</span>
                    </button>
                </div>
                <p class="text-muted text-xs mb-4">Claude will write a professional article in NL, EN, and FI based on the research.</p>
                <div id="generate-progress" class="hidden space-y-3">
                    <div class="progress-bar">
                        <div id="gen-progress-fill" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <div id="gen-progress-text" class="text-xs text-muted text-center">Initializing...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════ -->
    <!-- PREVIEW MODAL                                   -->
    <!-- ═══════════════════════════════════════════════ -->
    <div id="modal-preview" class="modal-overlay">
        <div class="modal-content">
            <!-- Header -->
            <div class="sticky top-0 z-10 flex items-center justify-between px-6 py-4 border-b border-white/5 bg-surface">
                <div class="flex items-center gap-4">
                    <h2 class="font-display font-semibold text-light text-sm">Preview</h2>
                    <div class="flex gap-1">
                        <button class="tab-btn active" onclick="switchPreviewLang('nl')" data-preview-lang="nl">NL</button>
                        <button class="tab-btn" onclick="switchPreviewLang('en')" data-preview-lang="en">EN</button>
                        <button class="tab-btn" onclick="switchPreviewLang('fi')" data-preview-lang="fi">FI</button>
                    </div>
                </div>
                <button onclick="closePreview()" class="text-muted hover:text-light transition-colors p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            <!-- Preview content -->
            <div id="preview-body" class="p-6">
                <div id="preview-loading" class="flex items-center justify-center py-16">
                    <div class="spinner spinner-lg"></div>
                </div>
                <div id="preview-content" class="hidden"></div>
            </div>
        </div>
    </div>


    <!-- ═══════════════════════════════════════════════ -->
    <!-- APPLICATION JAVASCRIPT                          -->
    <!-- ═══════════════════════════════════════════════ -->
    <script>
    (function() {
        'use strict';

        // ── Configuration ──
        const SUPABASE_URL = 'https://qwqcstsafgiexhdzbpim.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3cWNzdHNhZmdpZXhoZHpicGltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NzgwODMsImV4cCI6MjA4NzI1NDA4M30.PXZmTQNOMPcsUV6of26z32TFm2gQUook8SgJFnlqOWU';
        const API_BASE = window.location.hostname === 'localhost' ? '' : '';

        // ── Supabase Client ──
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ── App State ──
        const state = {
            user: null,
            session: null,
            posts: [],
            currentPost: null,
            currentFilter: 'all',
            editorLang: 'nl',
            previewLang: 'nl',
            keywords: [],
            feedbackComments: [],
            researchData: null,
            loading: false,
        };

        // ── DOM Ready ──
        document.addEventListener('DOMContentLoaded', init);

        async function init() {
            // Check for existing session
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                state.session = session;
                state.user = session.user;
                navigateTo('dashboard');
            } else {
                navigateTo('login');
            }

            // Listen for auth changes (handles OAuth redirect + sign out)
            supabase.auth.onAuthStateChange((event, session) => {
                state.session = session;
                state.user = session ? session.user : null;
                if (event === 'SIGNED_IN' && session) {
                    navigateTo('dashboard');
                } else if (event === 'SIGNED_OUT') {
                    navigateTo('login');
                }
            });

            // Setup login form
            document.getElementById('login-form').addEventListener('submit', handleLogin);

            // Setup filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    state.currentFilter = btn.dataset.filter;
                    renderPosts();
                });
            });

            // Handle hash routing
            window.addEventListener('hashchange', handleRoute);
            handleRoute();
        }

        // ── Router ──
        function handleRoute() {
            const hash = window.location.hash.slice(1) || '';
            const [route, param] = hash.split('/');

            if (!state.session && route !== 'login') {
                navigateTo('login');
                return;
            }

            switch (route) {
                case 'login':
                    showScreen('login');
                    break;
                case 'dashboard':
                    showScreen('dashboard');
                    loadPosts();
                    break;
                case 'editor':
                    showScreen('editor');
                    if (param && param !== 'new') {
                        loadPost(param);
                    } else {
                        initNewPost();
                    }
                    break;
                case 'generate':
                    showScreen('generate');
                    break;
                default:
                    if (state.session) {
                        navigateTo('dashboard');
                    } else {
                        navigateTo('login');
                    }
            }
        }

        function navigateTo(route, param) {
            window.location.hash = param ? `${route}/${param}` : route;
        }
        // Expose globally
        window.navigateTo = navigateTo;

        function showScreen(name) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const el = document.getElementById(`screen-${name}`);
            if (el) {
                el.classList.add('active');
                // Force re-animation
                el.style.animation = 'none';
                el.offsetHeight; // trigger reflow
                el.style.animation = '';
            }
            if (name === 'dashboard' && state.user) {
                document.getElementById('user-email').textContent = state.user.email;
            }
        }

        // ── Auth ──
        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('login-error');
            const btn = document.getElementById('login-btn');

            errorEl.classList.add('hidden');
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner mx-auto"></div>';

            try {
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) throw error;

                state.session = data.session;
                state.user = data.user;
                showToast('Welcome back!', 'success');
                navigateTo('dashboard');
            } catch (err) {
                errorEl.textContent = err.message || 'Login failed. Please check your credentials.';
                errorEl.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>Sign In</span><svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>';
            }
        }

        async function handleGoogleLogin() {
            const btn = document.getElementById('google-login-btn');
            btn.disabled = true;
            btn.style.opacity = '0.6';
            const errorEl = document.getElementById('login-error');
            errorEl.classList.add('hidden');

            try {
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin + '/admin',
                    },
                });
                if (error) throw error;
            } catch (err) {
                errorEl.textContent = err.message || 'Google login failed.';
                errorEl.classList.remove('hidden');
                btn.disabled = false;
                btn.style.opacity = '1';
            }
        }
        window.handleGoogleLogin = handleGoogleLogin;

        async function handleLogout() {
            await supabase.auth.signOut();
            state.session = null;
            state.user = null;
            state.posts = [];
            state.currentPost = null;
            navigateTo('login');
            showToast('Signed out', 'info');
        }
        window.handleLogout = handleLogout;

        // ── API Helpers ──
        function getAuthHeaders() {
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${state.session?.access_token || ''}`,
            };
        }

        async function apiGet(path) {
            const res = await fetch(`${API_BASE}${path}`, { headers: getAuthHeaders() });
            if (!res.ok) {
                const err = await res.json().catch(() => ({ error: res.statusText }));
                throw new Error(err.error || `Request failed (${res.status})`);
            }
            return res.json();
        }

        async function apiPost(path, body) {
            const res = await fetch(`${API_BASE}${path}`, {
                method: 'POST',
                headers: getAuthHeaders(),
                body: JSON.stringify(body),
            });
            if (!res.ok) {
                const err = await res.json().catch(() => ({ error: res.statusText }));
                throw new Error(err.error || `Request failed (${res.status})`);
            }
            return res.json();
        }

        async function apiPut(path, body) {
            const res = await fetch(`${API_BASE}${path}`, {
                method: 'PUT',
                headers: getAuthHeaders(),
                body: JSON.stringify(body),
            });
            if (!res.ok) {
                const err = await res.json().catch(() => ({ error: res.statusText }));
                throw new Error(err.error || `Request failed (${res.status})`);
            }
            return res.json();
        }

        async function apiDelete(path) {
            const res = await fetch(`${API_BASE}${path}`, {
                method: 'DELETE',
                headers: getAuthHeaders(),
            });
            if (!res.ok) {
                const err = await res.json().catch(() => ({ error: res.statusText }));
                throw new Error(err.error || `Request failed (${res.status})`);
            }
            return res.json();
        }

        // ── Posts CRUD ──
        async function loadPosts() {
            const loadingEl = document.getElementById('posts-loading');
            const emptyEl = document.getElementById('posts-empty');
            const listEl = document.getElementById('posts-list');

            loadingEl.classList.remove('hidden');
            emptyEl.classList.add('hidden');

            try {
                const data = await apiGet('/api/blog/posts');
                state.posts = Array.isArray(data) ? data : (data.posts || []);
                updateStats();
                renderPosts();
            } catch (err) {
                showToast(`Failed to load posts: ${err.message}`, 'error');
                state.posts = [];
                renderPosts();
            } finally {
                loadingEl.classList.add('hidden');
            }
        }

        function updateStats() {
            const posts = state.posts;
            document.getElementById('stat-total').textContent = posts.length;
            document.getElementById('stat-published').textContent = posts.filter(p => p.status === 'published').length;
            document.getElementById('stat-drafts').textContent = posts.filter(p => p.status === 'draft').length;
            document.getElementById('stat-ai').textContent = posts.filter(p => p.generation_topic || p.research_data).length;
        }

        function renderPosts() {
            const listEl = document.getElementById('posts-list');
            const emptyEl = document.getElementById('posts-empty');
            const loadingEl = document.getElementById('posts-loading');

            loadingEl.classList.add('hidden');

            let filtered = state.posts;
            if (state.currentFilter !== 'all') {
                filtered = filtered.filter(p => p.status === state.currentFilter);
            }

            if (filtered.length === 0) {
                listEl.innerHTML = '';
                emptyEl.classList.remove('hidden');
                return;
            }

            emptyEl.classList.add('hidden');

            listEl.innerHTML = filtered.map(post => {
                const date = post.published_at
                    ? new Date(post.published_at).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' })
                    : new Date(post.created_at).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
                const statusClass = `badge-${post.status}`;
                const catClass = `cat-${post.category}`;
                const catLabel = { 'aetherbot': 'AetherBot', 'aethermind': 'AetherMIND', 'aetherdev': 'AetherDEV' }[post.category] || post.category;
                const aiIcon = (post.generation_topic || post.research_data)
                    ? '<svg class="w-3.5 h-3.5 text-accent-violet inline ml-1.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>'
                    : '';

                return `
                    <div class="post-row grid grid-cols-1 md:grid-cols-12 gap-2 md:gap-4 px-6 py-4 items-center cursor-pointer" onclick="navigateTo('editor','${post.id}')">
                        <div class="md:col-span-5">
                            <div class="font-display font-semibold text-sm text-light truncate">${escapeHtml(post.title_nl || 'Untitled')}${aiIcon}</div>
                            <div class="text-xs text-muted truncate mt-0.5 md:hidden">${date}</div>
                        </div>
                        <div class="md:col-span-2">
                            <span class="badge ${statusClass}">${post.status}</span>
                        </div>
                        <div class="md:col-span-2">
                            <span class="cat-badge ${catClass}">${catLabel}</span>
                        </div>
                        <div class="md:col-span-2 text-sm text-muted hidden md:block">${date}</div>
                        <div class="md:col-span-1 text-right">
                            <button onclick="event.stopPropagation(); navigateTo('editor','${post.id}')" class="text-muted hover:text-accent-cyan transition-colors p-1" title="Edit">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ── Editor ──
        function initNewPost() {
            state.currentPost = {
                id: null,
                title_nl: '', title_en: '', title_fi: '',
                slug_nl: '', slug_en: '', slug_fi: '',
                description_nl: '', description_en: '', description_fi: '',
                content_nl: '', content_en: '', content_fi: '',
                category: 'aethermind',
                status: 'draft',
                author: 'Marco',
                author_title: 'CTO & AI Lead Architect',
                seo_keywords: [],
                word_count: 0,
                read_time: 0,
            };
            state.keywords = [];
            populateEditor();
        }

        async function loadPost(id) {
            try {
                // Try to find post from state first
                let post = state.posts.find(p => p.id === id);
                if (!post) {
                    const data = await apiGet('/api/blog/posts');
                    state.posts = Array.isArray(data) ? data : (data.posts || []);
                    post = state.posts.find(p => p.id === id);
                }
                if (!post) {
                    showToast('Post not found', 'error');
                    navigateTo('dashboard');
                    return;
                }
                state.currentPost = { ...post };
                state.keywords = Array.isArray(post.seo_keywords) ? [...post.seo_keywords] : [];
                populateEditor();
            } catch (err) {
                showToast(`Failed to load post: ${err.message}`, 'error');
                navigateTo('dashboard');
            }
        }

        function populateEditor() {
            const p = state.currentPost;
            if (!p) return;

            document.getElementById('editor-category').value = p.category || 'aethermind';
            document.getElementById('editor-status').value = p.status || 'draft';
            document.getElementById('editor-author').value = p.author || 'Marco';
            document.getElementById('editor-author-title').value = p.author_title || 'CTO & AI Lead Architect';

            ['nl', 'en', 'fi'].forEach(lang => {
                document.getElementById(`editor-title-${lang}`).value = p[`title_${lang}`] || '';
                document.getElementById(`editor-slug-${lang}`).value = p[`slug_${lang}`] || '';
                document.getElementById(`editor-desc-${lang}`).value = p[`description_${lang}`] || '';
                document.getElementById(`editor-content-${lang}`).value = p[`content_${lang}`] || '';
            });

            renderKeywords();
            updateWordCount();
            switchEditorLang('nl');

            // Quality & Feedback
            document.getElementById('editor-quality-score').textContent = p.quality_score != null ? `${p.quality_score}/100` : '—';
            const fbScore = p.feedback_score || 0;
            document.getElementById('editor-feedback-score').value = fbScore;
            document.getElementById('feedback-score-val').textContent = fbScore;
            document.getElementById('editor-learning-notes').value = p.learning_notes || '';
            state.feedbackComments = Array.isArray(p.feedback_comments) ? [...p.feedback_comments] : [];
            renderFeedbackComments();

            // Show/hide delete button
            document.getElementById('btn-delete').style.display = p.id ? 'flex' : 'none';
        }

        function collectEditorData() {
            const p = state.currentPost || {};
            return {
                id: p.id || undefined,
                title_nl: document.getElementById('editor-title-nl').value.trim(),
                title_en: document.getElementById('editor-title-en').value.trim(),
                title_fi: document.getElementById('editor-title-fi').value.trim(),
                slug_nl: document.getElementById('editor-slug-nl').value.trim(),
                slug_en: document.getElementById('editor-slug-en').value.trim(),
                slug_fi: document.getElementById('editor-slug-fi').value.trim(),
                description_nl: document.getElementById('editor-desc-nl').value.trim(),
                description_en: document.getElementById('editor-desc-en').value.trim(),
                description_fi: document.getElementById('editor-desc-fi').value.trim(),
                content_nl: document.getElementById('editor-content-nl').value,
                content_en: document.getElementById('editor-content-en').value,
                content_fi: document.getElementById('editor-content-fi').value,
                category: document.getElementById('editor-category').value,
                status: document.getElementById('editor-status').value,
                author: document.getElementById('editor-author').value.trim(),
                author_title: document.getElementById('editor-author-title').value.trim(),
                seo_keywords: state.keywords,
                word_count: countWords(),
                read_time: Math.max(1, Math.ceil(countWords() / 200)),
                feedback_score: parseInt(document.getElementById('editor-feedback-score').value) || null,
                learning_notes: document.getElementById('editor-learning-notes').value.trim() || null,
                feedback_comments: state.feedbackComments || [],
            };
        }

        async function handleSaveDraft() {
            const btn = document.getElementById('btn-save-draft');
            const originalHtml = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div><span>Saving...</span>';

            try {
                const data = collectEditorData();
                if (!data.title_nl) {
                    showToast('Title (NL) is required', 'error');
                    return;
                }

                // Ensure slugs exist
                if (!data.slug_nl) data.slug_nl = slugify(data.title_nl);
                if (!data.slug_en) data.slug_en = slugify(data.title_en || data.title_nl);
                if (!data.slug_fi) data.slug_fi = slugify(data.title_fi || data.title_nl);

                let savedPost;
                if (data.id) {
                    savedPost = await apiPut(`/api/blog/posts?id=${data.id}`, data);
                } else {
                    savedPost = await apiPost('/api/blog/posts', data);
                }
                savedPost = savedPost.post || savedPost;

                if (savedPost.id && !state.currentPost.id) {
                    state.currentPost.id = savedPost.id;
                    window.location.hash = `editor/${savedPost.id}`;
                }

                state.currentPost = { ...state.currentPost, ...data, id: state.currentPost.id || savedPost.id };
                showToast('Draft saved successfully', 'success');

                // Show autosave indicator
                const autosaveEl = document.getElementById('editor-autosave');
                autosaveEl.classList.remove('hidden');
                autosaveEl.textContent = 'Saved';
                setTimeout(() => autosaveEl.classList.add('hidden'), 3000);
            } catch (err) {
                showToast(`Save failed: ${err.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalHtml;
            }
        }
        window.handleSaveDraft = handleSaveDraft;

        async function handlePublish() {
            const btn = document.getElementById('btn-publish');
            const originalHtml = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div><span>Publishing...</span>';

            try {
                // First save
                const data = collectEditorData();
                data.status = 'published';
                data.published_at = data.published_at || new Date().toISOString();

                if (!data.title_nl) {
                    showToast('Title (NL) is required', 'error');
                    return;
                }
                if (!data.slug_nl) data.slug_nl = slugify(data.title_nl);
                if (!data.slug_en) data.slug_en = slugify(data.title_en || data.title_nl);
                if (!data.slug_fi) data.slug_fi = slugify(data.title_fi || data.title_nl);

                if (data.id) {
                    await apiPut(`/api/blog/posts?id=${data.id}`, data);
                } else {
                    const saved = await apiPost('/api/blog/posts', data);
                    data.id = (saved.post || saved).id;
                    state.currentPost.id = data.id;
                }

                // Then publish (IndexNow etc.)
                try {
                    await apiPost(`/api/blog/publish?id=${state.currentPost.id || data.id}`, {});
                } catch (pubErr) {
                    // Publish-specific actions might fail but post is saved
                    console.warn('Publish notification failed:', pubErr);
                }

                // Handle cross-posting
                const linkedIn = document.getElementById('crosspost-linkedin').checked;
                const medium = document.getElementById('crosspost-medium').checked;
                if (linkedIn || medium) {
                    try {
                        await apiPost('/api/blog/cross-post', {
                            id: state.currentPost.id,
                            linkedin: linkedIn,
                            medium: medium,
                        });
                        showToast('Published and cross-posted!', 'success');
                    } catch (cpErr) {
                        showToast('Published, but cross-posting failed: ' + cpErr.message, 'error');
                    }
                } else {
                    showToast('Published successfully!', 'success');
                }

                document.getElementById('editor-status').value = 'published';
                state.currentPost.status = 'published';
            } catch (err) {
                showToast(`Publish failed: ${err.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalHtml;
            }
        }
        window.handlePublish = handlePublish;

        async function handleDeletePost() {
            if (!state.currentPost?.id) return;
            if (!confirm('Are you sure you want to delete this post? This action cannot be undone.')) return;

            const btn = document.getElementById('btn-delete');
            btn.disabled = true;

            try {
                await apiDelete(`/api/blog/posts?id=${state.currentPost.id}`);
                showToast('Post deleted', 'info');
                navigateTo('dashboard');
            } catch (err) {
                showToast(`Delete failed: ${err.message}`, 'error');
            } finally {
                btn.disabled = false;
            }
        }
        window.handleDeletePost = handleDeletePost;

        // ── Editor Helpers ──
        function switchEditorLang(lang) {
            state.editorLang = lang;
            ['nl', 'en', 'fi'].forEach(l => {
                document.getElementById(`tab-${l}`).classList.toggle('hidden', l !== lang);
            });
            document.querySelectorAll('.tab-btn[data-lang]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            updateWordCount();
        }
        window.switchEditorLang = switchEditorLang;

        function autoSlug(lang) {
            const title = document.getElementById(`editor-title-${lang}`).value;
            document.getElementById(`editor-slug-${lang}`).value = slugify(title);
        }
        window.autoSlug = autoSlug;

        function slugify(text) {
            return text
                .toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '')
                .slice(0, 80);
        }

        function countWords() {
            const content = document.getElementById(`editor-content-${state.editorLang}`)?.value || '';
            const text = content.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
            return text ? text.split(' ').length : 0;
        }

        function updateWordCount() {
            const words = countWords();
            const readTime = Math.max(1, Math.ceil(words / 200));
            document.getElementById('editor-wordcount').textContent = words.toLocaleString();
            document.getElementById('editor-readtime').textContent = `${readTime} min`;
        }

        // Auto-update word count on content change
        document.addEventListener('input', (e) => {
            if (e.target.id && e.target.id.startsWith('editor-content-')) {
                updateWordCount();
            }
        });

        function updateEditorState() {
            // Just keep state synced
        }
        window.updateEditorState = updateEditorState;

        // ── Keywords ──
        function addKeyword() {
            const input = document.getElementById('keyword-input');
            const keyword = input.value.trim().toLowerCase();
            if (keyword && !state.keywords.includes(keyword)) {
                state.keywords.push(keyword);
                renderKeywords();
            }
            input.value = '';
            input.focus();
        }
        window.addKeyword = addKeyword;

        function removeKeyword(index) {
            state.keywords.splice(index, 1);
            renderKeywords();
        }
        window.removeKeyword = removeKeyword;

        function renderKeywords() {
            const container = document.getElementById('keywords-list');
            container.innerHTML = state.keywords.map((kw, i) =>
                `<span class="keyword-tag">${escapeHtml(kw)}<button onclick="removeKeyword(${i})">&times;</button></span>`
            ).join('');
        }

        // ── Feedback Comments ──
        function addFeedbackComment() {
            const input = document.getElementById('feedback-comment-input');
            const text = input.value.trim();
            if (text) {
                if (!state.feedbackComments) state.feedbackComments = [];
                state.feedbackComments.push({
                    text,
                    date: new Date().toISOString().split('T')[0],
                    author: 'admin',
                });
                renderFeedbackComments();
            }
            input.value = '';
            input.focus();
        }
        window.addFeedbackComment = addFeedbackComment;

        function removeFeedbackComment(index) {
            state.feedbackComments.splice(index, 1);
            renderFeedbackComments();
        }
        window.removeFeedbackComment = removeFeedbackComment;

        function renderFeedbackComments() {
            const container = document.getElementById('feedback-comments-list');
            if (!state.feedbackComments?.length) {
                container.innerHTML = '<p class="text-muted italic">No comments yet</p>';
                return;
            }
            container.innerHTML = state.feedbackComments.map((c, i) =>
                `<div class="flex items-start gap-2 p-2 rounded-lg bg-white/[0.02]">
                    <span class="flex-1">${escapeHtml(typeof c === 'string' ? c : c.text)} <span class="text-muted/60">${c.date || ''}</span></span>
                    <button onclick="removeFeedbackComment(${i})" class="text-red-400/60 hover:text-red-400 shrink-0">&times;</button>
                </div>`
            ).join('');
        }

        // ── AI Generator ──
        async function handleResearch() {
            const topic = document.getElementById('gen-topic').value.trim();
            if (!topic) {
                showToast('Please enter a topic first', 'error');
                return;
            }

            const btn = document.getElementById('btn-research');
            const outputEl = document.getElementById('research-output');
            const loadingEl = document.getElementById('research-loading');
            const resultEl = document.getElementById('research-result');

            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div><span>Researching...</span>';
            outputEl.classList.remove('hidden');
            loadingEl.classList.remove('hidden');
            resultEl.classList.add('hidden');

            try {
                const data = await apiPost('/api/blog/research', {
                    topic,
                    category: document.getElementById('gen-category').value,
                });

                state.researchData = data.research || data;
                resultEl.textContent = typeof state.researchData === 'string'
                    ? state.researchData
                    : JSON.stringify(state.researchData, null, 2);
                resultEl.classList.remove('hidden');

                // Enable generate button
                document.getElementById('btn-generate').disabled = false;
                showToast('Research complete!', 'success');
            } catch (err) {
                showToast(`Research failed: ${err.message}`, 'error');
            } finally {
                loadingEl.classList.add('hidden');
                btn.disabled = false;
                btn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg><span>Research Topic</span>';
            }
        }
        window.handleResearch = handleResearch;

        async function handleGenerate() {
            const topic = document.getElementById('gen-topic').value.trim();
            if (!topic) {
                showToast('Please enter a topic first', 'error');
                return;
            }

            const btn = document.getElementById('btn-generate');
            const progressEl = document.getElementById('generate-progress');
            const fillEl = document.getElementById('gen-progress-fill');
            const textEl = document.getElementById('gen-progress-text');

            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div><span>Generating...</span>';
            progressEl.classList.remove('hidden');

            // Simulated progress stages
            const stages = [
                { pct: 15, text: 'Analyzing research data...' },
                { pct: 30, text: 'Writing Dutch version...' },
                { pct: 50, text: 'Writing English version...' },
                { pct: 70, text: 'Writing Finnish version...' },
                { pct: 85, text: 'Generating SEO metadata...' },
                { pct: 95, text: 'Finalizing article...' },
            ];

            let stageIndex = 0;
            const progressInterval = setInterval(() => {
                if (stageIndex < stages.length) {
                    fillEl.style.width = stages[stageIndex].pct + '%';
                    textEl.textContent = stages[stageIndex].text;
                    stageIndex++;
                }
            }, 2500);

            try {
                const data = await apiPost('/api/blog/generate', {
                    topic,
                    category: document.getElementById('gen-category').value,
                    research: state.researchData,
                });

                clearInterval(progressInterval);
                fillEl.style.width = '100%';
                textEl.textContent = 'Article generated!';

                const post = data.post || data;
                const qualityScore = data.quality_score || post.quality_score;
                const autoPublishable = data.auto_publishable;

                if (qualityScore != null) {
                    const scoreMsg = autoPublishable
                        ? `Quality: ${qualityScore}/100 — Auto-publishable!`
                        : `Quality: ${qualityScore}/100 — Needs review (< 85)`;
                    showToast(scoreMsg, qualityScore >= 85 ? 'success' : 'info');
                } else {
                    showToast('Article generated successfully!', 'success');
                }

                // Save the generated article to Supabase
                let savedPost = post;
                if (!post.id) {
                    try {
                        savedPost = await apiPost('/api/blog/posts', post);
                    } catch (saveErr) {
                        showToast(`Generated but failed to save: ${saveErr.message}`, 'error');
                    }
                }

                // Navigate to editor with the new post
                setTimeout(() => {
                    const id = savedPost.id || post.id;
                    if (id) {
                        navigateTo('editor', id);
                    } else {
                        // Load the generated content directly into editor
                        state.currentPost = post;
                        state.keywords = Array.isArray(post.seo_keywords) ? [...post.seo_keywords] : [];
                        populateEditor();
                        showScreen('editor');
                    }
                }, 1000);
            } catch (err) {
                clearInterval(progressInterval);
                showToast(`Generation failed: ${err.message}`, 'error');
                fillEl.style.width = '0%';
                textEl.textContent = 'Generation failed';
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg><span>Generate Article</span>';
            }
        }
        window.handleGenerate = handleGenerate;

        // ── Preview ──
        function openPreview() {
            document.getElementById('modal-preview').classList.add('open');
            loadPreview(state.previewLang);
        }
        window.openPreview = openPreview;

        function closePreview() {
            document.getElementById('modal-preview').classList.remove('open');
        }
        window.closePreview = closePreview;

        function switchPreviewLang(lang) {
            state.previewLang = lang;
            document.querySelectorAll('[data-preview-lang]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.previewLang === lang);
            });
            loadPreview(lang);
        }
        window.switchPreviewLang = switchPreviewLang;

        async function loadPreview(lang) {
            const loadingEl = document.getElementById('preview-loading');
            const contentEl = document.getElementById('preview-content');

            loadingEl.classList.remove('hidden');
            contentEl.classList.add('hidden');

            const slug = document.getElementById(`editor-slug-${lang}`)?.value;
            if (slug && state.currentPost?.id) {
                try {
                    const res = await fetch(`${API_BASE}/api/blog/render?lang=${lang}&slug=${slug}`, {
                        headers: getAuthHeaders(),
                    });
                    if (res.ok) {
                        const html = await res.text();
                        contentEl.innerHTML = `<iframe class="preview-frame" srcdoc="${escapeAttr(html)}"></iframe>`;
                        loadingEl.classList.add('hidden');
                        contentEl.classList.remove('hidden');
                        return;
                    }
                } catch (e) {
                    // Fall through to local preview
                }
            }

            // Local preview fallback
            const title = document.getElementById(`editor-title-${lang}`)?.value || 'Untitled';
            const desc = document.getElementById(`editor-desc-${lang}`)?.value || '';
            const content = document.getElementById(`editor-content-${lang}`)?.value || '<p>No content yet.</p>';
            const author = document.getElementById('editor-author')?.value || 'Marco';

            const previewHtml = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
                    <style>
                        * { box-sizing: border-box; margin: 0; padding: 0; }
                        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #05060f; color: #e4e8f1; padding: 40px 24px; max-width: 800px; margin: 0 auto; line-height: 1.8; }
                        h1 { font-family: 'Syne', sans-serif; font-size: 2rem; font-weight: 800; margin-bottom: 12px; background: linear-gradient(135deg, #00d4ff, #8b5cf6); -webkit-background-clip: text; background-clip: text; color: transparent; }
                        .meta { color: #6b7394; font-size: 0.85rem; margin-bottom: 32px; padding-bottom: 24px; border-bottom: 1px solid rgba(255,255,255,0.06); }
                        .desc { color: #a0a7c0; font-size: 1.05rem; margin-bottom: 32px; font-style: italic; }
                        h2 { font-family: 'Syne', sans-serif; font-size: 1.4rem; font-weight: 700; color: #00d4ff; margin: 32px 0 16px; }
                        h3 { font-family: 'Syne', sans-serif; font-size: 1.15rem; font-weight: 600; color: #e4e8f1; margin: 24px 0 12px; }
                        p { margin-bottom: 16px; color: #c8cee0; }
                        ul, ol { margin: 16px 0; padding-left: 24px; color: #c8cee0; }
                        li { margin-bottom: 8px; }
                        strong { color: #e4e8f1; }
                        blockquote { border-left: 3px solid #8b5cf6; padding: 12px 20px; margin: 24px 0; background: rgba(139,92,246,0.06); border-radius: 0 8px 8px 0; color: #a0a7c0; }
                        code { background: rgba(0,212,255,0.08); padding: 2px 6px; border-radius: 4px; font-size: 0.9em; color: #00d4ff; }
                        pre { background: rgba(255,255,255,0.03); padding: 16px; border-radius: 8px; overflow-x: auto; margin: 16px 0; border: 1px solid rgba(255,255,255,0.06); }
                        pre code { background: none; padding: 0; }
                        a { color: #00d4ff; text-decoration: none; }
                        a:hover { text-decoration: underline; }
                        img { max-width: 100%; border-radius: 12px; margin: 16px 0; }
                        table { width: 100%; border-collapse: collapse; margin: 16px 0; }
                        th, td { padding: 10px 14px; border: 1px solid rgba(255,255,255,0.06); text-align: left; }
                        th { background: rgba(255,255,255,0.03); font-family: 'Syne', sans-serif; font-weight: 600; }
                    </style>
                </head>
                <body>
                    <h1>${escapeHtml(title)}</h1>
                    <div class="meta">By ${escapeHtml(author)} &middot; ${new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                    ${desc ? `<p class="desc">${escapeHtml(desc)}</p>` : ''}
                    ${content}
                </body>
                </html>
            `;

            contentEl.innerHTML = `<iframe class="preview-frame" srcdoc="${escapeAttr(previewHtml)}"></iframe>`;
            loadingEl.classList.add('hidden');
            contentEl.classList.remove('hidden');
        }

        // ── New Post ──
        function createNewPost() {
            navigateTo('editor', 'new');
        }
        window.createNewPost = createNewPost;

        // ── Toast Notifications ──
        function showToast(message, type = 'info') {
            const container = document.getElementById('toasts');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;

            const icons = {
                success: '<svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
                error: '<svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
                info: '<svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
            };

            toast.innerHTML = `${icons[type] || icons.info}<span>${escapeHtml(message)}</span>`;
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // ── Utility ──
        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function escapeAttr(str) {
            return str.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

    })();
    </script>
</body>
</html>
